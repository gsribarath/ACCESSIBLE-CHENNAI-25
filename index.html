<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Accessible Chennai - Mode Selection</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background-color: #0a415d;
      color: #f8fafc;
    }
    .feature-card {
      transition: all 0.3s ease;
      transform-style: preserve-3d;
    }
    .feature-card:hover {
      transform: scale(1.05) translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.13);
    }
    .feature-card:active {
      transform: scale(0.98);
    }
    .mode-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 3.5rem;
      height: 3.5rem;
      border-radius: 1rem;
      background: linear-gradient(135deg, #025274 30%, #054d69 100%);
      color: #fff;
      font-size: 2rem;
      margin-bottom: 1.1rem;
      box-shadow: 0 4px 32px #38bdf842;
    }
    .mode-card-bg1 {
      background: #12354d;
    }
    .mode-card-bg2 {
      background: #173c54;
    }
    .mode-card-selected {
      border: 2.5px solid #38bdf8;
    }
    .mode-section-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 72vh;
    }
    @media (max-width: 700px) {
      .mode-section-center {
        min-height: 64vh !important;
      }
      .mode-card-bg1,
      .mode-card-bg2 {
        min-width: unset;
        width: 96vw !important;
      }
    }
    /* Splash Screen Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .animate-fade-in {
      animation: fadeIn 0.8s ease-out forwards;
    }
    .animate-slide-up {
      animation: slideUp 0.8s ease-out 0.3s forwards;
    }
    .animate-pulse {
      animation: pulse 2s infinite;
    }
    /* Reduced motion settings */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation: none !important;
        transition: none !important;
        scroll-behavior: auto !important;
      }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- Splash Screen -->
  <div
    id="splash"
    class="fixed inset-0 z-50 flex items-center justify-center"
    style="background-color: #0d3a58"
  >
    <div class="text-center">
      <div class="mb-10 animate-fade-in">
        <div class="flex items-center justify-center">
          <img
            src="ACCESSIBLECHENNAII.png"
            alt="Accessible Chennai Logo"
            class="h-96 w-96 object-cover rounded-full animate-pulse shadow-2xl"
          />
        </div>
      </div>
      <h1
        class="text-6xl font-extrabold text-white mb-4 animate-slide-up tracking-wide"
      >
        Accessible Chennai
      </h1>
      <p class="text-white text-2xl opacity-0 animate-slide-up font-light">
        Loading...
      </p>
    </div>
  </div>

  <!-- Main content -->
  <main
    id="main-content"
    class="flex-grow hidden"
  >
    <section
      aria-labelledby="mode-selection-heading"
      class="relative overflow-hidden py-8 md:py-12 flex flex-col items-center"
    >
      <div class="container mx-auto px-4 mode-section-center">
        <h2 id="mode-selection-heading" class="text-3xl font-bold mb-8 text-white text-center">
          Choose Your Navigation Mode
        </h2>
        <!-- Mode selection cards -->
        <div
          class="flex flex-col md:flex-row justify-center gap-7 max-w-2xl mx-auto"
        >
          <!-- Voice Mode Card -->
          <button
            id="voice-mode-btn"
            type="button"
            class="feature-card mode-card-bg1 p-7 md:p-10 rounded-2xl border-0 focus:shadow-lg md:w-80 w-full flex flex-col items-center md:h-80 h-fit hover:scale-105 transition"
            aria-label="Select Voice Mode"
            onclick="selectMode('voice')"
          >
            <span
              class="mode-icon"
              style="background: linear-gradient(135deg, #16a34a 40%, #059669 100%)"
              ><i class="fas fa-volume-up"></i
            ></span>
            <span class="text-2xl font-bold">Voice Mode</span>
            <span
              class="mt-2 block text-sm font-medium text-green-300"
              style="letter-spacing: 0.01em"
              >Recommended for visually<br />impaired users</span
            >
            <span class="mt-3 text-base font-normal opacity-90 text-slate-200"
              >Full voice interaction with audio feedback for all actions and
              navigation</span
            >
          </button>
          <!-- Normal Mode Card -->
          <button
            id="normal-mode-btn"
            type="button"
            class="feature-card mode-card-bg2 p-7 md:p-10 rounded-2xl border-0 focus:shadow-lg md:w-80 w-full flex flex-col items-center md:h-80 h-fit hover:scale-105 transition"
            aria-label="Select Normal Mode"
            onclick="selectMode('normal')"
          >
            <span
              class="mode-icon"
              style="background: linear-gradient(135deg, #6d28d9 40%, #a21caf 100%)"
              ><i class="fas fa-mouse-pointer"></i
            ></span>
            <span class="text-2xl font-bold">Normal Mode</span>
            <span
              class="mt-2 block text-sm font-medium text-purple-300"
              style="letter-spacing: 0.01em"
              >Standard visual interaction</span
            >
            <span class="mt-3 text-base font-normal opacity-90 text-slate-200"
              >Traditional visual interface with click and touch
              interactions</span
            >
          </button>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer (empty but maintaining structure) -->
  <footer
    class="text-white py-4 hidden"
    id="footer"
    style="background-color: #0a415d;"
  >
    <div class="container mx-auto px-4">
      <!-- Footer content -->
    </div>
  </footer>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    let preferredVoice = null;

    function setPreferredVoice() {
      const voices = window.speechSynthesis.getVoices();
      preferredVoice = voices.find(
        (voice) =>
          voice.lang === "en-GB" &&
          (voice.name.includes("Female") || voice.name.includes("Google UK English Female"))
      );
      if (!preferredVoice) preferredVoice = voices.find((voice) => voice.lang === "en-GB");
      if (!preferredVoice)
        preferredVoice = voices.find((voice) => voice.lang && voice.lang.startsWith("en"));
    }

    if ("speechSynthesis" in window) {
      window.speechSynthesis.onvoiceschanged = setPreferredVoice;
      setPreferredVoice();
    }

    let recognition;
    let isVoiceMode = false;
    let recognitionActive = false;
    let justHandledCommand = false;
    let promptSpoken = false; 

    function speak(text) {
      if (!("speechSynthesis" in window)) return;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "en-GB";
      utterance.volume = 1;
      utterance.rate = 1;
      utterance.pitch = 1;
      setPreferredVoice();
      if (preferredVoice) utterance.voice = preferredVoice;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utterance);
    }

    function speakAndRedirect(text, url) {
      if (!("speechSynthesis" in window)) {
        window.location.href = url;
        return;
      }
      window.speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "en-GB";
      setPreferredVoice();
      if (preferredVoice) utterance.voice = preferredVoice;
      utterance.onend = () => {
        window.location.href = url;
      };
      window.speechSynthesis.speak(utterance);
    }

    function startRecognition() {
      if (recognitionActive) return;
      if (!("SpeechRecognition" in window || "webkitSpeechRecognition" in window)) return;
      recognitionActive = true;
      recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.continuous = true;  
      recognition.interimResults = false;
      recognition.lang = "en-IN";

      recognition.onresult = function (event) {
        const transcript = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
        if (justHandledCommand) return;
        justHandledCommand = true;
        handleVoiceCommand(transcript);
      };

      recognition.onerror = function (event) {
        recognitionActive = false;
        justHandledCommand = false;
        setTimeout(() => {
          if (!justHandledCommand) startRecognition();
        }, 150);
      };

      recognition.onend = function () {
        recognitionActive = false;
        setTimeout(() => {
          if (!justHandledCommand) startRecognition();
        }, 150);
      };

      try {
        recognition.start();
      } catch (e) {}
    }

    function stopRecognition() {
      recognitionActive = false;
      if (recognition) try { recognition.stop(); } catch (e) {}
    }

    function handleVoiceCommand(command) {
      if (!isVoiceMode) {
        if (command.includes("voice mode")) {
          speakAndRedirect("Redirecting to voice mode", "voicemode.html");
          isVoiceMode = true;
          stopRecognition();
          return;
        } else if (command.includes("normal mode")) {
          speakAndRedirect("Redirecting to normal mode", "home.html");
          stopRecognition();
          return;
        }
      } else {
        const commands = [
          { phrase: "home", response: "Redirecting to home", url: "index.html" },
          { phrase: "navigate", response: "Redirecting to navigation", url: "navigate.html" },
          { phrase: "community", response: "Redirecting to community", url: "community.html" },
          { phrase: "alerts", response: "Redirecting to alerts", url: "alerts.html" },
          { phrase: "settings", response: "Redirecting to settings", url: "settings.html" },
        ];
        const matchedCommand = commands.find((cmd) => command.includes(cmd.phrase));
        if (matchedCommand) {
          speakAndRedirect(matchedCommand.response, matchedCommand.url);
          stopRecognition();
          return;
        }
        speak("Command not recognized. Please say Home, Navigate, Community, Settings or Alerts.");
      }
      justHandledCommand = false;
      startRecognition();
    }

    function selectMode(mode) {
      stopRecognition();
      justHandledCommand = true;
      if (mode === "normal") {
        speakAndRedirect("Redirecting to normal mode", "home.html");
      } else if (mode === "voice") {
        speakAndRedirect("Redirecting to voice mode", "voicemode.html");
        isVoiceMode = true;
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      setTimeout(() => {
        document.getElementById("splash").classList.add("opacity-0", "transition-opacity", "duration-500");
        setTimeout(() => {
          document.getElementById("splash").classList.add("hidden");
          document.getElementById("main-content").classList.remove("hidden");
          document.getElementById("footer").classList.remove("hidden");
          AOS.init({
            duration: 800,
            easing: "ease-in-out",
            once: true,
            mirror: false,
          });
          if (!promptSpoken) {
            speak("Please select voice mode or normal mode.");
            promptSpoken = true;
          }
          setTimeout(() => startRecognition(), 50);
        }, 500);
      }, 2000);
    });

    if (window.location.pathname.endsWith("voicemode.html")) {
      isVoiceMode = true;
      setTimeout(function () {
        startRecognition();
      }, 600);
    }
  </script>
</body>
</html>